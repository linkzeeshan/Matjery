/*
* Copyright 2016 Seven Spikes Ltd. All rights reserved. (http://www.nop-templates.com)
* http://www.nop-templates.com/t/licensinginfo
*/

function loadMapScript() { var n = document.createElement("script"), t = $("#customer-nop-address").attr("data-googleapikey").trim(); n.src = "https://maps.googleapis.com/maps/api/js?v=3.exp&libraries=places&callback=initializeMap"; t && (n.src += "&key=" + t); document.body.appendChild(n) } function getCustomMapStyles() { var t = $("#customer-nop-address").attr("data-mapstyles"), n = ""; if (!t) return n; try { n = JSON.parse(t) } catch (i) { console.log("Invalid custom map styles value!") } return n } function initializeMap() { var n = document.getElementById(mapWrapperId), t = { center: new google.maps.LatLng(40.713081, -74.006287), zoom: 15, mapTypeId: google.maps.MapTypeId.ROADMAP, styles: getCustomMapStyles() }; map = new google.maps.Map(n, t); google.maps.event.addListenerOnce(map, "idle", function () { placeMarkerByAvailableMethod(); createMapSearchBox() }); google.maps.event.addListener(map, "click", function (n) { repositionMarker(n.latLng.lat(), n.latLng.lng()) }) } function addMarker(n, t, i, r) { var f = $("#" + mapWrapperId).attr("data-pathtoimages") + "/footer-map-marker-icon.png", u = new google.maps.Marker({ position: new google.maps.LatLng(n, t), map: map, title: i, icon: f, draggable: r }); markers.push(u); u.setMap(map); map.setCenter(new google.maps.LatLng(n, t)); google.maps.event.addListener(u, "dragend", function (n) { latitudeElement.val(n.latLng.lat()); longitudeElement.val(n.latLng.lng()) }) } function setMarkerByAddress(n) { n != null && n.length > 0 && $.ajax({ cache: !1, type: "GET", url: "http://maps.google.com/maps/api/geocode/json?address=" + n + "&sensor=false", success: function (n) { n && n.status != "ZERO_RESULTS" && n.results.length > 0 && repositionMarker(n.results[0].geometry.location.lat, n.results[0].geometry.location.lng) } }) } function placeMarkerByAvailableMethod() { var n, u; addMarker("40.713081", "-74.006287", "Placed", !0); var t = "0", i = "0", r = new RegExp(/^-?\d+\.?\d*$/); if (latitudeElement.length > 0 && longitudeElement.length > 0 && latitudeElement.val().length > 0 && longitudeElement.val().length > 0 && r.test(latitudeElement.val().trim()) && r.test(longitudeElement.val().trim())) { t = latitudeElement.val().trim(); i = longitudeElement.val().trim(); repositionMarker(t, i); return } navigator.geolocation ? navigator.geolocation.getCurrentPosition(function (n) { repositionMarker(n.coords.latitude, n.coords.longitude); return }) : (n = $("#customer-nop-address"), n.length > 0 && n.val().length > 0 && (u = n.val(), setMarkerByAddress(u))) } function repositionMarker(n, t) { markers[0].setPosition(new google.maps.LatLng(n, t)); map.setCenter(new google.maps.LatLng(n, t)); latitudeElement.val(markers[0].position.lat()); longitudeElement.val(markers[0].position.lng()) } function moveMarkerOnCoordinatesChange() { var n = latitudeElement.val(), t = longitudeElement.val(), i = new RegExp(/^-?\d+\.?\d*$/); n.length > 0 && t.length > 0 && i.test(n) && i.test(t) && (markers[0].setPosition(new google.maps.LatLng(n, t)), map.setCenter(new google.maps.LatLng(n, t))) } function setAllMap(n) { for (var t = 0; t < markers.length; t++) markers[t].setMap(n) } function clearMarkers() { setAllMap(null) } function showMarkers() { setAllMap(map) } function deleteMarkers() { clearMarkers(); markers = [] } function createMapSearchBox() { var n, t; $("#shop-address-input").on("keyup keypress", function (n) { if (n.which == 13) return n.preventDefault(), !1 }); n = document.getElementById("shop-address-input"); map.controls[google.maps.ControlPosition.TOP_LEFT].push(n); t = new google.maps.places.SearchBox(n); n.style.display = "block"; google.maps.event.addListener(t, "places_changed", function () { var n = t.getPlaces(); n.length != 0 && (repositionMarker(n[0].geometry.location.lat(), n[0].geometry.location.lng()), map.setCenter(n[0].geometry.location)) }) } var mapWrapperId = "chooseLocationMap", map, markers = [], latitudeElement, longitudeElement; $(document).ready(function () { $("#urban-settings-edit a[data-tab-name='tab-additional-settings']").on("click", function () { setTimeout(function () { google.maps.event.trigger(map, "resize") }) }); loadMapScript(); latitudeElement = $("#Latitude"); longitudeElement = $("#Longitude"); $(latitudeElement).on("change", moveMarkerOnCoordinatesChange); $(longitudeElement).on("change", moveMarkerOnCoordinatesChange) });